(function(a){a.address=(function(){var d=function(am){a(a.address).trigger(a.extend(a.Event(am),(function(){var aq={},ap=a.address.parameterNames();for(var ao=0,an=ap.length;ao<an;ao++){aq[ap[ao]]=a.address.parameter(ap[ao])}return{value:a.address.value(),path:a.address.path(),pathNames:a.address.pathNames(),parameterNames:ap,parameters:aq,queryString:a.address.queryString()}}).call(a.address)))},k=function(ao,an,am){a().bind.apply(a(a.address),Array.prototype.slice.call(arguments));return a.address},P=function(){return(ad.pushState&&G.state!==K)},J=function(){return("/"+Z.pathname.replace(new RegExp(G.state),"")+Z.search+(V()?"#"+V():"")).replace(R,"/")},V=function(){var am=Z.href.indexOf("#");return am!=-1?F(Z.href.substr(am+1),ae):""},B=function(){return P()?J():V()},b=function(){try{return top.document!==K?top:window}catch(am){return window}},m=function(){return"javascript"},ak=function(am){am=am.toString();return(G.strict&&am.substr(0,1)!="/"?"/":"")+am},F=function(am,an){if(G.crawlable&&an){return(am!==""?"!":"")+am}return am.replace(/^\!/,"")},U=function(am,an){return parseInt(am.css(an),10)},l=function(aq){var an,ap;for(var ao=0,am=aq.childNodes.length;ao<am;ao++){try{if("src" in aq.childNodes[ao]&&aq.childNodes[ao].src){an=String(aq.childNodes[ao].src)}}catch(ar){}ap=l(aq.childNodes[ao]);if(ap){an=ap}}return an},ac=function(){if(!u){var an=B(),am=X!=an;if(am){if(h&&r<7){Z.reload()}else{if(h&&r<8&&G.history){o(H,50)}X=an;aa(ae)}}}},aa=function(am){d(I);d(am?g:aj);o(y,10)},y=function(){if(G.tracker!=="null"&&G.tracker!==null){var am=a.isFunction(G.tracker)?G.tracker:S[G.tracker],an=(Z.pathname+Z.search+(a.address&&!P()?a.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");if(a.isFunction(am)){am(an)}else{if(a.isFunction(S.urchinTracker)){S.urchinTracker(an)}else{if(S.pageTracker!==K&&a.isFunction(S.pageTracker._trackPageview)){S.pageTracker._trackPageview(an)}else{if(S._gaq!==K&&a.isFunction(S._gaq.push)){S._gaq.push(["_trackPageview",decodeURI(an)])}}}}}},H=function(){var am=m()+":"+ae+";document.open();document.writeln('<html><head><title>"+ah.title.replace("'","\\'")+"</title><script>var "+A+' = "'+encodeURIComponent(B())+(ah.domain!=Z.hostname?'";document.domain="'+ah.domain:"")+"\";<\/script></head></html>');document.close();";if(r<7){e.src=am}else{e.contentWindow.location.replace(am)}},af=function(){if(j&&c!=-1){var an,am=j.substr(c+1).split("&");for(i=0;i<am.length;i++){an=am[i].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(an[0])){G[an[0]]=(isNaN(an[1])?/^(true|yes)$/i.test(an[1]):(parseInt(an[1],10)!==0))}if(/^(state|tracker)$/.test(an[0])){G[an[0]]=an[1]}}j=null}X=B()},T=function(){if(!Y){Y=E;af();var ao=function(){x.call(this);s.call(this)},an=a("body").ajaxComplete(ao);ao();if(G.wrap){var ap=a("body > *").wrapAll('<div style="padding:'+(U(an,"marginTop")+U(an,"paddingTop"))+"px "+(U(an,"marginRight")+U(an,"paddingRight"))+"px "+(U(an,"marginBottom")+U(an,"paddingBottom"))+"px "+(U(an,"marginLeft")+U(an,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+A+'" style="height:100%;overflow:auto;position:relative;'+(t&&!window.statusbar.visible?"resize:both;":"")+'" />');a("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});if(t){a('<style type="text/css" />').appendTo("head").text("#"+A+"::-webkit-resizer { background-color: #fff; }")}}if(h&&r<8){var am=ah.getElementsByTagName("frameset")[0];e=ah.createElement((am?"":"i")+"frame");if(am){am.insertAdjacentElement("beforeEnd",e);am[am.cols?"cols":"rows"]+=",0";e.noResize=E;e.frameBorder=e.frameSpacing=0}else{e.style.display="none";e.style.width=e.style.height=0;e.tabIndex=-1;ah.body.insertAdjacentElement("afterBegin",e)}o(function(){a(e).bind("load",function(){var aq=e.contentWindow;X=aq[A]!==K?aq[A]:"";if(X!=B()){aa(ae);Z.hash=F(X,E)}});if(e.contentWindow[A]===K){H()}},50)}o(function(){d("init");aa(ae)},1);if(!P()){if((h&&r>7)||(!h&&("on"+W) in S)){if(S.addEventListener){S.addEventListener(W,ac,ae)}else{if(S.attachEvent){S.attachEvent("on"+W,ac)}}}else{v(ac,50)}}}},x=function(){var ap,ar=a("a"),aq=ar.size(),an=1,am=-1,ao=function(){}},q=function(){if(X!=B()){X=B();aa(ae)}},p=function(){if(S.removeEventListener){S.removeEventListener(W,ac,ae)}else{if(S.detachEvent){S.detachEvent("on"+W,ac)}}},s=function(){if(G.crawlable){var an=Z.pathname.replace(/\/$/,""),am="_escaped_fragment_";if(a("body").html().indexOf(am)!=-1){a('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var ao=a(this).attr("href").replace(/^http:/,"").replace(new RegExp(an+"/?$"),"");if(ao===""||ao.indexOf(am)!=-1){a(this).attr("href","#"+ao.replace(new RegExp("/(.*)\\?"+am+"=(.*)$"),"!$2"))}})}}},K,A="jQueryAddress",ab="string",W="hashchange",n="init",I="change",g="internalChange",aj="externalChange",E=true,ae=false,G={autoUpdate:E,crawlable:ae,history:E,strict:E,wrap:ae},D=a.browser,r=parseFloat(a.browser.version),ag=D.mozilla,h=D.msie,O=D.opera,t=D.webkit||D.safari,ai=ae,S=b(),ah=S.document,ad=S.history,Z=S.location,v=setInterval,o=setTimeout,R=/\/{2,9}/g,al=navigator.userAgent,e,M,j=l(document),c=j?j.indexOf("?"):-1,L=ah.title,u=ae,Y=ae,Q=E,N=E,z=ae,C={},X=B();if(h){r=parseFloat(al.substr(al.indexOf("MSIE")+4));if(ah.documentMode&&ah.documentMode!=r){r=ah.documentMode!=8?7:8}var w=ah.onpropertychange;ah.onpropertychange=function(){if(w){w.call(ah)}if(ah.title!=L&&ah.title.indexOf("#"+B())!=-1){ah.title=L}}}ai=(ag&&r>=1)||(h&&r>=6)||(O&&r>=9.5)||(t&&r>=523);if(ai){if(O){history.navigationMode="compatible"}if(document.readyState=="complete"){var f=setInterval(function(){if(a.address){T();clearInterval(f)}},50)}else{af();a(T)}a(window).bind("popstate",q).bind("unload",p)}else{if(!ai&&V()!==""){Z.replace(Z.href.substr(0,Z.href.indexOf("#")))}else{y()}}return{bind:function(an,ao,am){return k(an,ao,am)},init:function(am){return k(n,am)},change:function(am){return k(I,am)},internalChange:function(am){return k(g,am)},externalChange:function(am){return k(aj,am)},baseURL:function(){var am=Z.href;if(am.indexOf("#")!=-1){am=am.substr(0,am.indexOf("#"))}if(/\/$/.test(am)){am=am.substr(0,am.length-1)}return am},autoUpdate:function(am){if(am!==K){G.autoUpdate=am;return this}return G.autoUpdate},crawlable:function(am){if(am!==K){G.crawlable=am;return this}return G.crawlable},history:function(am){if(am!==K){G.history=am;return this}return G.history},state:function(am){if(am!==K){G.state=am;var an=J();if(G.state!==K){if(ad.pushState){if(an.substr(0,3)=="/#/"){Z.replace(G.state.replace(/^\/$/,"")+an.substr(2))}}else{if(an!="/"&&an.replace(/^\/#/,"")!=V()){o(function(){Z.replace(G.state.replace(/^\/$/,"")+"/#"+an)},1)}}}return this}return G.state},strict:function(am){if(am!==K){G.strict=am;return this}return G.strict},tracker:function(am){if(am!==K){G.tracker=am;return this}return G.tracker},wrap:function(am){if(am!==K){G.wrap=am;return this}return G.wrap},update:function(){z=E;this.value(X);z=ae;return this},title:function(am){if(am!==K){o(function(){L=ah.title=am;if(N&&e&&e.contentWindow&&e.contentWindow.document){e.contentWindow.document.title=am;N=ae}if(!Q&&ag){Z.replace(Z.href.indexOf("#")!=-1?Z.href:Z.href+"#")}Q=ae},50);return this}return ah.title},value:function(am){if(am!==K){am=ak(am);if(am=="/"){am=""}if(X==am&&!z){return}Q=E;X=am;if(G.autoUpdate||z){aa(E);if(P()){ad[G.history?"pushState":"replaceState"]({},"",G.state.replace(/\/$/,"")+(X===""?"/":X))}else{u=E;if(t){if(G.history){Z.hash="#"+F(X,E)}else{Z.replace("#"+F(X,E))}}else{if(X!=B()){if(G.history){Z.hash="#"+F(X,E)}else{Z.replace("#"+F(X,E))}}}if((h&&r<8)&&G.history){o(H,50)}if(t){o(function(){u=ae},1)}else{u=ae}}}}if(!ai){return null}return ak(X)},path:function(an){if(an!==K){var am=this.queryString(),ao=this.hash();this.value(an+(am?"?"+am:"")+(ao?"#"+ao:""));return this}return ak(X).split("#")[0].split("?")[0]},pathNames:function(){var an=this.path(),am=an.replace(R,"/").split("/");if(an.substr(0,1)=="/"||an.length===0){am.splice(0,1)}if(an.substr(an.length-1,1)=="/"){am.splice(am.length-1,1)}return am},queryString:function(an){if(an!==K){var ao=this.hash();this.value(this.path()+(an?"?"+an:"")+(ao?"#"+ao:""));return this}var am=X.split("?");return am.slice(1,am.length).join("?").split("#")[0]},parameter:function(an,aw,ap){var au,ar;if(aw!==K){var av=this.parameterNames();ar=[];aw=aw?aw.toString():"";for(au=0;au<av.length;au++){var aq=av[au],ax=this.parameter(aq);if(typeof ax==ab){ax=[ax]}if(aq==an){ax=(aw===null||aw==="")?[]:(ap?ax.concat([aw]):[aw])}for(var at=0;at<ax.length;at++){ar.push(aq+"="+ax[at])}}if(a.inArray(an,av)==-1&&aw!==null&&aw!==""){ar.push(an+"="+aw)}this.queryString(ar.join("&"));return this}aw=this.queryString();if(aw){var am=[];ar=aw.split("&");for(au=0;au<ar.length;au++){var ao=ar[au].split("=");if(ao[0]==an){am.push(ao.slice(1).join("="))}}if(am.length!==0){return am.length!=1?am:am[0]}}},parameterNames:function(){var am=this.queryString(),ap=[];if(am&&am.indexOf("=")!=-1){var aq=am.split("&");for(var ao=0;ao<aq.length;ao++){var an=aq[ao].split("=")[0];if(a.inArray(an,ap)==-1){ap.push(an)}}}return ap},hash:function(an){if(an!==K){this.value(X.split("#")[0]+(an?"#"+an:""));return this}var am=X.split("#");return am.slice(1,am.length).join("#")}}})();a.fn.address=function(b){if(!a(this).attr("address")){var c=function(f){if(f.shiftKey||f.ctrlKey||f.metaKey){return true}if(a(this).is("a")){var d=b?b.call(this):/address:/.test(a(this).attr("rel"))?a(this).attr("rel").split("address:")[1].split(" ")[0]:a.address.state()!==undefined&&a.address.state()!="/"?a(this).attr("href").replace(new RegExp("^(.*"+a.address.state()+"|\\.)"),""):a(this).attr("href").replace(/^(#\!?|\.)/,"");a.address.value(d);f.preventDefault()}};a(this).click(c).live("click",c).live("submit",function(g){if(a(this).is("form")){var f=a(this).attr("action"),d=b?b.call(this):(f.indexOf("?")!=-1?f.replace(/&$/,""):f+"?")+a(this).serialize();a.address.value(d);g.preventDefault()}}).attr("address",true)}return this}})(jQuery);
